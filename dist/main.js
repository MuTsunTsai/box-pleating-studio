if(!err&&!wErr){if("undefined"==typeof TextDecoder)throw new Error("TextDecoder is needed");var bp=new BPStudio("#divWorkspace");function sanitize(e){let t='/\\:*|"<>'.split(""),s="∕∖∶∗∣″‹›".split("");for(let i in t)e=e.replace(RegExp("\\"+t[i],"g"),s[i]);return e.replace(/\?/g,"ʔ̣").replace(/\s+/g," ").replace(/[\x00-\x1f\x80-\x9f]/g,"").replace(/^\.*$/,"project").replace(/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,"project").replace(/[\. ]+$/,"project")}function readFile(e){return new Promise((t,s)=>{let i=new FileReader;i.onload=e=>t(e.target.result),i.onerror=e=>s(e),i.readAsArrayBuffer(e)})}function bufferToText(e){return(new TextDecoder).decode(new Uint8Array(e))}const LZ={compress:e=>(e=LZMA.compress(e,1),(e=btoa(String.fromCharCode.apply(null,Uint8Array.from(e)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+/g,"")),decompress(e){e=atob(e.replace(/-/g,"+").replace(/_/g,"/"));const t=new Uint8Array(e.length);for(let s=0;s<t.length;s++)t[s]=e.charCodeAt(s);return LZMA.decompress(t)}},BaseComponent={watch:{selection(){}},computed:{design:()=>core.design,selections:()=>core.selections,selection(){return this.selections[0]}}},Dialog={data:()=>({promise:null,message:void 0}),methods:{async show(e){for(this.message=e;this.promise;)await this.promise;return await(this.promise=this.run())},run(){let e=$(this.$el),t=new Promise(t=>this.resolve(e=>{this.promise=null,t(e)},e));return e.modal({backdrop:"static"}),t},resolve(e,t){},undefined:void 0}},InputMixin={data(){return{id:"field"+this._uid,v:null,focused:!1}},props:{value:null},watch:{value(e){this.focused||(this.v=e)}},methods:{blur(){this.v=this.value,this.focused=!1},focus(e){this.focused=!0,e.target.select()},input(e){this.v=e.target.value,this.$emit("input",this.v)}},mounted(){this.v=this.value}};Vue.component("app",{render(){with(this)return _c("div",{attrs:{id:"app"},on:{mousedown:function(e){e.stopPropagation()},touchstart:function(e){e.stopPropagation()}}},[_c("toolbar",{on:{panel:function(e){showPanel=!showPanel},share:function(e){return show("share")},about:function(e){return show("about")},news:function(e){return show("ver")},pref:function(e){return show("pref")}}}),_v(" "),design?_e():_c("welcome"),_v(" "),_c("div",{class:{show:showPanel},attrs:{id:"divShade"},on:{mousedown:function(e){showPanel=!1},touchstart:function(e){showPanel=!1}}}),_v(" "),_c("panel",{attrs:{show:showPanel}}),_v(" "),_c("dpad"),_v(" "),_c("share",{ref:"share"}),_v(" "),_c("about",{ref:"about"}),_v(" "),_c("version",{ref:"ver"}),_v(" "),_c("preference",{ref:"pref"})],1)},mixins:[BaseComponent],data:()=>({showPanel:!1}),methods:{show(e){this.$refs[e].show()}},created(){bp.system.onLongPress=()=>this.showPanel=!0,bp.system.onDrag=()=>this.showPanel=!1},mounted(){"none"!=getComputedStyle(this.$el).touchAction&&this.$el.addEventListener("touchmove",e=>{e.touches.length>1&&e.preventDefault()})}}),Vue.component("core",{render(){with(this)return _c("div",[_c("confirm",{ref:"confirm"}),_v(" "),_c("alert",{ref:"alert"}),_v(" "),design&&design.patternNotFound?_c("note"):_e(),_v(" "),_c("div",{staticClass:"modal fade",attrs:{id:"mdlLanguage"}},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content"},[_c("div",{staticClass:"modal-body"},[_c("div",{staticClass:"row"},_l(languages,(function(e){return _c("div",{key:e,staticClass:"col text-center"},[_c("button",{staticClass:"w-100 btn btn-light",attrs:{"data-dismiss":"modal"},on:{click:function(t){i18n.locale=e}}},[_c("img",{attrs:{src:"assets/flags/"+$t("flag",e)+".png"}}),_v(" "),_c("br"),_v("\n\t\t\t\t\t\t\t\t"+_s($t("name",e))+"\n\t\t\t\t\t\t\t")])])})),0)])])])])],1)},data:()=>({designs:[],tabHistory:[],autoSave:!0,showDPad:!0,isTouch:void 0,id:(new Date).getTime().toString(),heartbeat:null,languages:[],dropdown:null}),watch:{"i18n.locale"(){this.onLocaleChanged()}},computed:{i18n:()=>i18n,copyright(){let e=(new Date).getFullYear(),t=e>2020?"-"+e:"";return this.$t("welcome.copyright",[t])},design(){let e=bp.design?bp.design.title:null;return document.title="Box Pleating Studio"+(e?" - "+e:""),bp.design},selections:()=>bp.system.selections},methods:{loadSettings(){let e=JSON.parse(localStorage.getItem("settings"));if(e){this.autoSave=e.autoSave,void 0!==e.showDPad&&(this.showDPad=e.showDPad);let t=bp.$display.settings;for(let s in t)t[s]=e[s]}let t=localStorage.getItem("locale"),s=e=>e.replace(/_/g,"-").toLowerCase();if(!t&&navigator.languages){let e=Object.keys(locale),i=navigator.languages.map(t=>e.find(e=>s(t).startsWith(e))).filter(e=>!!e);i=Array.from(new Set(i)),i.length>1&&(this.languages=i,$("#mdlLanguage").modal()),t=i[0]||navigator.languages[0]}t||(t="en"),i18n.locale=s(t),this.onLocaleChanged()},onLocaleChanged(){i18n.locale in locale?localStorage.setItem("locale",i18n.locale):Vue.nextTick(()=>{let e=i18n._localeChainCache[i18n.locale];for(let t of e)if(t in locale)return void(i18n.locale=t)})},saveSettings(){let{showGrid:e,showHinge:t,showRidge:s,showAxialParallel:i,showLabel:a,showDot:n,includeHiddenElement:o}=bp.$display.settings;this.autoSave?this.save():localStorage.removeItem("session"),localStorage.setItem("settings",JSON.stringify({autoSave:this.autoSave,showDPad:this.showDPad,includeHiddenElement:o,showGrid:e,showHinge:t,showRidge:s,showAxialParallel:i,showLabel:a,showDot:n}))},open(e){"string"==typeof e?this.addDesign(bp.design=bp.load(e)):this.addDesign(bp.design=bp.restore(e))},checkSession(){let e=localStorage.getItem("sessionId"),t=localStorage.getItem("sessionTime"),s=(new Date).getTime();return(!e||e>this.id||t<(s-3e3).toString())&&localStorage.setItem("sessionId",e=this.id),this.heartbeat&&this.id!=e?(clearInterval(this.heartbeat),this.heartbeat=null):this.heartbeat||this.id!=e||(this.heartbeat=setInterval(()=>this.beat(),1e3)),e==this.id},beat(){localStorage.setItem("sessionTime",(new Date).getTime().toString())},save(e){let t=this.checkSession();if(this.autoSave&&t){let e={jsons:this.designs.map(e=>bp.designMap.get(e)),open:bp.design?this.designs.indexOf(bp.design.id):-1};localStorage.setItem("session",JSON.stringify(e))}e&&t&&localStorage.removeItem("sessionId")},create(){let e={title:this.$t("keyword.untitled")},t=bp.create(this.checkTitle(e));this.addDesign(bp.design=t),Vue.nextTick(()=>this.scrollTo(t.id))},scrollTo(e){document.getElementById("tab"+e).scrollIntoView()},select(e){bp.select(e),this.tabHistory.splice(this.tabHistory.indexOf(e),1),this.tabHistory.unshift(e),this.scrollTo(e)},async closeCore(e){let t=bp.designMap.get(e),s=t.title||this.$t("keyword.untitled");if(t.history.modified){bp.select(e);let t=this.$t("message.unsaved",[s]);if(!await this.confirm(t))return!1}return this.designs.splice(this.designs.indexOf(e),1),this.tabHistory.splice(this.tabHistory.indexOf(e),1),bp.close(e),!0},async close(e){void 0===e&&(e=bp.design.id),await this.closeCore(e)&&(bp.select(this.tabHistory.length?this.tabHistory[0]:null),Shrewd.commit())},async closeBy(e){for(let t of this.designs.concat())e(t)&&await this.closeCore(t);Shrewd.commit()},async closeOther(e){bp.select(e),await this.closeBy(t=>t!=e)},async closeRight(e){bp.design.id>e&&bp.select(e),await this.closeBy(t=>t>e)},async closeAll(){await this.closeBy(e=>!0),bp.select(this.tabHistory.length?this.tabHistory[0]:null)},clone(e){void 0===e&&(e=bp.design.id);let t=this.designs.indexOf(e),s=bp.restore(this.checkTitle(bp.designMap.get(e).toJSON()));this.designs.splice(t+1,0,(bp.design=s).id),Shrewd.commit(),gtag("event","project_clone")},addDesign(e){this.designs.push(e.id),this.tabHistory.unshift(e.id)},checkTitle(e){let t=e.title.replace(/ - \d+$/,""),s=1,i=[...bp.designMap.values()];if(!i.some(e=>e.title==t))return e;for(;i.some(e=>e.title==t+" - "+s);)s++;return e.title=t+" - "+s,e},async zip(){let e=new JSZip,t=new Set;for(let i=0;i<this.designs.length;i++){let a=bp.designMap.get(this.designs[i]),n=sanitize(a.title);if(t.has(n)){for(var s=1;t.has(n+" ("+s+")");s++);n=n+" ("+s+")"}t.add(n),e.file(n+".bps",JSON.stringify(a))}let i=await e.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});return URL.createObjectURL(i)},async alert(e){await this.$refs.alert.show(e)},async confirm(e){return await this.$refs.confirm.show(e)}},created(){this.isTouch=matchMedia("(hover: none), (pointer: coarse)").matches},mounted(){if(this.loadSettings(),bp.onDeprecate=e=>{e=e||this.$t("keyword.untitled"),this.alert(this.$t("message.oldVersion",[e]))},this.checkSession()){let e=JSON.parse(localStorage.getItem("session"));e&&(e.jsons.forEach(e=>this.addDesign(bp.restore(e))),e.open>=0&&(bp.select(this.designs[e.open]),Vue.nextTick(()=>this.scrollTo(e.open))),Shrewd.commit())}setInterval(()=>this.save(),5e3),window.addEventListener("beforeunload",()=>this.save(!0))}}),Vue.component("dpad",{render(){with(this)return _c("div",{class:{show:show},attrs:{id:"divDPad"}},[_c("keybutton",{staticClass:"bp-up",staticStyle:{top:"0rem",left:"2.5rem"},on:{key:function(e){return key("up")}}}),_v(" "),_c("keybutton",{staticClass:"bp-left",staticStyle:{top:"2.5rem",left:"0rem"},on:{key:function(e){return key("left")}}}),_v(" "),_c("keybutton",{staticClass:"bp-right",staticStyle:{top:"2.5rem",left:"5rem"},on:{key:function(e){return key("right")}}}),_v(" "),_c("keybutton",{staticClass:"bp-down",staticStyle:{top:"5rem",left:"2.5rem"},on:{key:function(e){return key("down")}}})],1)},computed:{show:()=>core.isTouch&&core.showDPad&&bp.system.selections.length>0},methods:{key(e){bp.system.key(e)}}}),Vue.component("welcome",{render(){with(this)return _c("div",{staticClass:"p-3",attrs:{id:"divWelcome"}},[_c("div",[_c("h2",{directives:[{name:"t",rawName:"v-t",value:"welcome.title",expression:"'welcome.title'"}],staticClass:"d-none d-sm-block"}),_v(" "),_c("h3",{directives:[{name:"t",rawName:"v-t",value:"welcome.title",expression:"'welcome.title'"}],staticClass:"d-sm-none"}),_v(" "),_c("p",{directives:[{name:"t",rawName:"v-t",value:"welcome.intro[0]",expression:"'welcome.intro[0]'"}],staticClass:"mt-4"}),_v(" "),_c("i18n",{attrs:{path:"welcome.intro[1]",tag:"p"}},[_c("a",{attrs:{target:"_blank",href:"https://github.com/MuTsunTsai/box-pleating-studio"}},[_v("GitHub")])])],1),_v(" "),_c("div",{staticClass:"browser-only"},[!bi&&!ios||install?_e():_c("div",[_c("p",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.hint",expression:"'welcome.install.hint'"}]}),_v(" "),ios?_c("p",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.ios",expression:"'welcome.install.ios'"}]}):_c("button",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.bt",expression:"'welcome.install.bt'"}],staticClass:"btn btn-primary",on:{click:function(e){return bi.prompt()}}})]),_v(" "),1==install?_c("div",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.ing",expression:"'welcome.install.ing'"}]}):_e(),_v(" "),2==install?_c("div",[_c("p",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.ed",expression:"'welcome.install.ed'"}]}),_v(" "),_c("a",{directives:[{name:"t",rawName:"v-t",value:"welcome.install.open",expression:"'welcome.install.open'"}],staticClass:"btn btn-primary",attrs:{href:"https://bpstudio.abstreamace.com/",target:"_blank"}})]):_e()]),_v(" "),_c("div",{staticStyle:{position:"absolute",bottom:"1rem",right:"1rem"}},[_v(_s(copyright))])])},data:()=>({bi:void 0,install:0,ios:!1===navigator.standalone}),computed:{copyright:()=>core.copyright},methods:{detectInstallation(){"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(e=>{e.length&&(this.install=2)})}},created(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.bi=e}),window.addEventListener("appinstalled",()=>{if(matchMedia("(display-mode: standalone)").matches)return;this.install=1;let e=setInterval(()=>{2!=this.install?this.detectInstallation():clearInterval(e)},2e3)}),this.detectInstallation()}}),Vue.component("about",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content mx-4"},[_c("div",{staticClass:"modal-header"},[_c("div",{directives:[{name:"t",rawName:"v-t",value:"about.title",expression:"'about.title'"}],staticClass:"h4 modal-title"})]),_v(" "),_c("div",{staticClass:"modal-body"},[_c("p",[_v(_s(copyright))]),_v(" "),_c("p",{directives:[{name:"t",rawName:"v-t",value:"about.license",expression:"'about.license'"}]}),_v(" "),_c("i18n",{attrs:{path:"about.visit",tag:"p"}},[_c("a",{directives:[{name:"t",rawName:"v-t",value:"about.homepage",expression:"'about.homepage'"}],attrs:{target:"_blank",href:"https://github.com/MuTsunTsai/box-pleating-studio"}})]),_v(" "),_c("i18n",{attrs:{path:"about.donation",tag:"p"}},[_c("a",{attrs:{target:"_blank",href:"donate.htm"}},[_v("PayPal")])])],1),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("div",{staticClass:"flex-grow-1"},[_v(_s($t("keyword.version"))+" "+_s(version))]),_v(" "),_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},computed:{copyright:()=>core.copyright,version:()=>document.querySelector("meta[name=version]").content+" build "+app_config.app_version},methods:{show(){$(this.$el).modal(),gtag("event","screen_view",{screen_name:"About"})}}}),Vue.component("alert",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content"},[_c("div",{staticClass:"modal-body"},[_v(_s(message))]),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},mixins:[Dialog],methods:{resolve(e,t){t.one("hidden.bs.modal",e)}}}),Vue.component("confirm",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content"},[_c("div",{staticClass:"modal-body"},[_v(_s(message))]),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.no",expression:"'keyword.no'"}],staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}}),_v(" "),_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.yes",expression:"'keyword.yes'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},mixins:[Dialog],methods:{resolve(e,t){let s=!1;t.find(".btn-primary").one("click",()=>s=!0),t.one("hidden.bs.modal",()=>e(s))}}}),Vue.component("note",{render(){with(this)return _c("div",[_c("button",{staticClass:"btn btn-light text-warning",attrs:{id:"note"},on:{click:note}},[_c("i",{staticClass:"fas fa-exclamation-triangle h1"})]),_v(" "),_c("div",{staticClass:"modal fade",attrs:{id:"mdlNote"}},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content"},[_c("div",{directives:[{name:"t",rawName:"v-t",value:"message.patternNotFound",expression:"'message.patternNotFound'"}],staticClass:"modal-body"}),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])])},methods:{note(){$("#mdlNote").modal(),gtag("event","screen_view",{screen_name:"Note"})}}}),Vue.component("share",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content mx-4"},[_c("div",{staticClass:"modal-header"},[_c("div",{directives:[{name:"t",rawName:"v-t",value:"share.title",expression:"'share.title'"}],staticClass:"h4 modal-title"})]),_v(" "),_c("div",{staticClass:"modal-body"},[_c("div",{staticClass:"mb-2"},[_c("input",{staticClass:"form-control",domProps:{value:url}})]),_v(" "),_c("div",[_c("button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:url,expression:"url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:onCopy,expression:"onCopy",arg:"success"}],staticClass:"btn btn-primary"},[_c("i",{staticClass:"fas fa-copy"}),_v("\n\t\t\t\t\t\t"+_s($t("share.copy"))+"\n\t\t\t\t\t\t"),_c("i",{ref:"success",staticClass:"fas fa-check d-inline-block",staticStyle:{transition:"width .5s",width:"0px",overflow:"hidden"}})]),_v(" "),canShare?_c("button",{staticClass:"btn btn-primary",on:{click:share}},[_c("i",{staticClass:"fas fa-share"}),_v("\n\t\t\t\t\t\t"+_s($t("share.share"))+"\n\t\t\t\t\t")]):_e()])]),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},mixins:[BaseComponent],data:()=>({url:"",canShare:!!navigator.share}),methods:{json(){if(this.design)return JSON.stringify(this.design)},show(){this.url="https://bpstudio.abstreamace.com/?project="+LZ.compress(this.json()),$(this.$el).modal(),gtag("event","screen_view",{screen_name:"Share"})},onCopy(){let e=this.$refs.success;e.style.width="20px",setTimeout(()=>e.style.width="0px",3e3),gtag("event","share",{method:"copy",content_type:"link"})},share(){navigator.share({title:"Box Pleating Studio",text:this.$t("share.message",[this.design.title]),url:this.url}).catch(()=>{}),gtag("event","share",{method:"app",content_type:"link"})}}}),Vue.component("version",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content mx-4"},[_c("div",{staticClass:"modal-body",staticStyle:{"max-height":"70vh","overflow-y":"auto"}},[record[index]?_c("div",{domProps:{innerHTML:_s(record[index])}}):_c("div",{staticClass:"m-5 display-2 text-muted text-center"},[_c("i",{staticClass:"fas fa-spinner fa-spin"})])]),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("div",{staticClass:"flex-grow-1"},[_c("button",{staticClass:"btn btn-primary",attrs:{disabled:0==index},on:{click:function(e){index--}}},[_c("i",{staticClass:"fas fa-caret-left"})]),_v(" "),_c("button",{staticClass:"btn btn-primary",attrs:{disabled:index==max},on:{click:function(e){index++}}},[_c("i",{staticClass:"fas fa-caret-right"})])]),_v(" "),_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},data:()=>({record:{},index:void 0,max:void 0,active:!1}),watch:{index(e){"https:"==location.protocol&&this.load(e)}},methods:{async load(e){if(!this.record[e])try{let t=await fetch(`log/${logs[e]}.md`);Vue.set(this.record,this.index,marked(await t.text()))}catch(e){return this.active&&($(this.$el).modal("hide"),core.alert(this.$t("message.connFail"))),!1}return!0},async show(){this.active=!0,await this.load(this.index)&&($(this.$el).modal(),gtag("event","screen_view",{screen_name:"News"}))}},mounted(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",async e=>{if("workbox-broadcast-update"===e.data.meta){let t=e.data.payload.path.match(/\d+(?=\.md$)/);if(t){let e=logs.indexOf(Number(t[0]));delete this.record[e],this.load(e)}}}),this.index=this.max=logs.length-1}}),Vue.component("contextmenu",{render(){with(this)return _c("div",{staticClass:"dropdown-menu",on:{touchstartout:hide,mousedownout:hide,touchend:hide,mouseup:hide}},[_t("default")],2)},data:()=>({shown:!1}),methods:{show(e){new Popper({getBoundingClientRect:()=>({top:e.pageY,bottom:e.pageY,left:e.pageX,right:e.pageX,width:0,height:0}),clientHeight:0,clientWidth:0},this.$el,{placement:"bottom-start"}),this.$el.classList.add("show"),this.shown=!0},hide(){this.shown&&(setTimeout(()=>this.$el.classList.remove("show"),10),this.shown=!1)}}}),Vue.component("divider",{render(){with(this)return _c("div",{staticStyle:{overflow:"auto"},on:{click:function(e){e.stopPropagation()}}},[_c("div",{staticClass:"dropdown-divider"})])}}),Vue.component("download",{render(){with(this)return disabled?_c("div",{staticClass:"dropdown-item disabled",on:{click:function(e){e.stopPropagation()}}},[_t("default")],2):_c("a",{class:btn?"btn btn-primary":"dropdown-item",attrs:{href:href,download:file.name,title:$t("message.downloadHint")},on:{click:download,mouseover:getFile,contextmenu:function(e){return e.stopPropagation(),contextMenu(e)}}},[_t("default")],2)},data:()=>({href:"#",downloaded:void 0,downloading:void 0,creating:null}),props:{file:Object,disabled:Boolean,btn:{type:Boolean,default:!1}},methods:{download(){"#"==this.href?(this.downloading=new Promise(e=>this.downloaded=e),event.preventDefault(),this.getFile().then(()=>this.$el.click())):(this.downloaded&&this.downloaded(),this.downloaded=null,this.$emit("download"))},contextMenu(){this.getFile(),this.$emit("download")},async getFile(){await this.creating,"#"==this.href&&(this.creating=this.file.content(),this.href=await this.creating,this.creating=null)},async reset(){await this.downloading,setTimeout(()=>{URL.revokeObjectURL(this.href),this.href="#"},500)}}}),Vue.component("dropdown",{render(){with(this)return _c("div",{staticClass:"btn-group"},[_c("button",{staticClass:"btn btn-primary dropdown-toggle",attrs:{type:"button",title:title,"data-toggle":"dropdown"},on:{mouseenter:mouseenter}},[_c("i",{class:icon}),_v(" "),notify?_c("div",{staticClass:"notify"}):_e()]),_v(" "),_c("div",{staticClass:"dropdown-menu",on:{touchstartout:hide,mousedownout:hide}},[_t("default")],2)])},data:()=>({bt:void 0}),props:{icon:String,title:String,notify:Boolean},methods:{hide(){this.bt.dropdown("hide")},mouseenter(){core.dropdown&&core.dropdown!=this&&this.bt.click()}},mounted(){let e=this;this.bt=$(this.$el).find("button"),$(this.$el).on("shown.bs.dropdown",(function(){core.dropdown=e})).on("hide.bs.dropdown",(function(){core.dropdown=null})).on("hidden.bs.dropdown",()=>this.$emit("hide"))}}),Vue.component("dropdownitem",{render(){with(this)return disabled?_c("div",{staticClass:"dropdown-item disabled",on:{click:function(e){e.stopPropagation()}}},[_t("default")],2):_c("div",{staticClass:"dropdown-item",on:{click:function(e){return $emit("click")}}},[_t("default")],2)},props:{disabled:Boolean}}),Vue.component("field",{render(){with(this)return"checkbox"==type?_c("div",{staticClass:"form-row"},[_c("div",{staticClass:"col"},[_c("div",{staticClass:"custom-control custom-checkbox"},[_c("input",{directives:[{name:"model",rawName:"v-model",value:v,expression:"v"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:id},domProps:{checked:Array.isArray(v)?_i(v,null)>-1:v},on:{change:function(e){var t=v,s=e.target,i=!!s.checked;if(Array.isArray(t)){var a=_i(t,null);s.checked?a<0&&(v=t.concat([null])):a>-1&&(v=t.slice(0,a).concat(t.slice(a+1)))}else v=i}}}),_v(" "),_c("label",{staticClass:"custom-control-label",attrs:{for:id}},[_v(_s(label))])])])]):_c("div",{staticClass:"form-row mb-1"},[_c("label",{staticClass:"col-form-label col-3"},[_v(_s(label))]),_v(" "),_c("div",{staticClass:"col-9"},["number"==type?_c("number",{attrs:{value:v},on:{input:function(e){return $emit("input",e)}}}):"checkbox"===type?_c("input",{directives:[{name:"model",rawName:"v-model",value:v,expression:"v"}],staticClass:"form-control",class:{error:v!=value},attrs:{placeholder:placeholder,type:"checkbox"},domProps:{checked:Array.isArray(v)?_i(v,null)>-1:v},on:{focus:function(e){return focus(e)},blur:blur,input:function(e){return input(e)},change:function(e){var t=v,s=e.target,i=!!s.checked;if(Array.isArray(t)){var a=_i(t,null);s.checked?a<0&&(v=t.concat([null])):a>-1&&(v=t.slice(0,a).concat(t.slice(a+1)))}else v=i}}}):"radio"===type?_c("input",{directives:[{name:"model",rawName:"v-model",value:v,expression:"v"}],staticClass:"form-control",class:{error:v!=value},attrs:{placeholder:placeholder,type:"radio"},domProps:{checked:_q(v,null)},on:{focus:function(e){return focus(e)},blur:blur,input:function(e){return input(e)},change:function(e){v=null}}}):_c("input",{directives:[{name:"model",rawName:"v-model",value:v,expression:"v"}],staticClass:"form-control",class:{error:v!=value},attrs:{placeholder:placeholder,type:type},domProps:{value:v},on:{focus:function(e){return focus(e)},blur:blur,input:[function(e){e.target.composing||(v=e.target.value)},function(e){return input(e)}]}})],1)])},mixins:[InputMixin],props:{label:String,type:String,placeholder:String},watch:{v(e){"checkbox"==this.type&&this.$emit("input",e)}}}),Vue.component("keybutton",{render(){with(this)return _c("i",{on:{touchstart:function(e){return down(750)},touchend:up}})},data:()=>({to:void 0}),methods:{down(e){this.$emit("key"),this.to=setTimeout(()=>this.down(150),e)},up(){clearTimeout(this.to)}}}),Vue.component("number",{render(){with(this)return _c("div",{staticClass:"input-group"},[_c("div",{staticClass:"input-group-prepend"},[_c("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:function(e){return change(-1)}}},[_c("i",{staticClass:"fas fa-minus"})])]),_v(" "),_c("input",{directives:[{name:"model",rawName:"v-model",value:v,expression:"v"}],staticClass:"form-control",class:{error:v!=value},attrs:{type:"number",min:min,max:max},domProps:{value:v},on:{focus:function(e){return focus(e)},blur:blur,input:[function(e){e.target.composing||(v=e.target.value)},function(e){return input(e)}],wheel:function(e){return wheel(e)}}}),_v(" "),_c("div",{staticClass:"input-group-append"},[_c("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:function(e){return change(1)}}},[_c("i",{staticClass:"fas fa-plus"})])])])},mixins:[InputMixin],props:{label:String,type:String,min:null,max:null},watch:{v(e){"checkbox"==this.type&&this.$emit("input",e)}},methods:{input(e){let t=Number(e.target.value);t<this.min||t>this.max||(this.v=t,this.$emit("input",this.v))},change(e){if(!(this.v+e<this.min||this.v+e>this.max))return this.$emit("input",this.v+e),this.v+e},wheel(e){e.stopPropagation(),e.preventDefault();let t=Math.round(-e.deltaY/100);this.v=this.change(t),Shrewd.commit()}}}),Vue.component("store",{render(){with(this)return _c("div",{staticClass:"form-row mb-1"},[_c("label",{staticClass:"col-form-label col-5"},[_v(_s(label))]),_v(" "),_c("div",{staticClass:"col-7"},[_c("div",{staticClass:"input-group"},[_c("div",{staticClass:"input-group-prepend"},[_c("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:function(e){return data.move(-1)}}},[_c("i",{staticClass:"fas fa-arrow-left"})])]),_v(" "),_c("input",{staticClass:"form-control text-center",attrs:{readonly:"",type:"text"},domProps:{value:data.index+1+" / "+data.size}}),_v(" "),_c("div",{staticClass:"input-group-append"},[_c("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:function(e){return data.move(1)}}},[_c("i",{staticClass:"fas fa-arrow-right"})])])])])])},props:{data:Object,label:String}}),Vue.component("uploader",{render(){with(this)return _c("div",[_c("input",{staticClass:"d-none",attrs:{type:"file",id:id,accept:accept,multiple:multiple},on:{change:function(e){return $emit("upload",e)}}}),_v(" "),_c("label",{staticClass:"dropdown-item m-0",attrs:{for:id}},[_t("default")],2)])},data(){return{id:"file"+this._uid}},props:{accept:String,multiple:Boolean}}),Vue.component("design",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.design.type",expression:"'panel.design.type'"}]}),_v(" "),_c("field",{attrs:{label:$t("panel.design.title"),type:"text",placeholder:$t("panel.design.titlePH")},model:{value:design.title,callback:function(e){$set(design,"title",e)},expression:"design.title"}}),_v(" "),_c("div",{staticClass:"mt-1 mb-4"},[_c("textarea",{directives:[{name:"model",rawName:"v-model",value:design.description,expression:"design.description"}],staticClass:"form-control",attrs:{rows:"4",placeholder:$t("panel.design.descriptionPH")},domProps:{value:design.description},on:{input:function(e){e.target.composing||$set(design,"description",e.target.value)}}})]),_v(" "),_c("div",{staticClass:"my-2"},["tree"==design.mode?_c("h6",{directives:[{name:"t",rawName:"v-t",value:"panel.design.tree",expression:"'panel.design.tree'"}]}):_e(),_v(" "),"layout"==design.mode?_c("h6",{directives:[{name:"t",rawName:"v-t",value:"panel.design.layout",expression:"'panel.design.layout'"}]}):_e()]),_v(" "),_c("field",{attrs:{label:$t("panel.design.width"),type:"number"},model:{value:design.sheet.width,callback:function(e){$set(design.sheet,"width",_n(e))},expression:"design.sheet.width"}}),_v(" "),_c("field",{attrs:{label:$t("panel.design.height"),type:"number"},model:{value:design.sheet.height,callback:function(e){$set(design.sheet,"height",_n(e))},expression:"design.sheet.height"}}),_v(" "),_c("field",{attrs:{label:$t("panel.design.autoScale"),type:"checkbox"},model:{value:design.fullscreen,callback:function(e){$set(design,"fullscreen",e)},expression:"design.fullscreen"}}),_v(" "),design.fullscreen?_e():_c("field",{attrs:{label:$t("panel.design.scale"),type:"number"},model:{value:design.sheet.scale,callback:function(e){$set(design.sheet,"scale",_n(e))},expression:"design.sheet.scale"}})],1)},mixins:[BaseComponent]}),Vue.component("edge",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.edge.type",expression:"'panel.edge.type'"}]}),_v(" "),_c("field",{attrs:{label:$t("panel.edge.length"),type:"number"},model:{value:selection.length,callback:function(e){$set(selection,"length",_n(e))},expression:"selection.length"}}),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.edge.split",expression:"'panel.edge.split'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.split()}}}),_v(" "),selection.edge.isRiver?_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.edge.merge",expression:"'panel.edge.merge'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.deleteAndMerge()}}}):_e()]),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:selection.edge.isRiver?"panel.edge.goto":"panel.vertex.goto",expression:"selection.edge.isRiver?'panel.edge.goto':'panel.vertex.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.edgeToRiver(selection)}}})])],1)},mixins:[BaseComponent]}),Vue.component("flap",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.flap.type",expression:"'panel.flap.type'"}]}),_v(" "),_c("field",{attrs:{label:$t("panel.flap.name"),type:"text"},model:{value:selection.name,callback:function(e){$set(selection,"name",e)},expression:"selection.name"}}),_v(" "),_c("field",{attrs:{label:$t("panel.flap.radius"),type:"number"},model:{value:selection.radius,callback:function(e){$set(selection,"radius",_n(e))},expression:"selection.radius"}}),_v(" "),_c("field",{attrs:{label:$t("panel.flap.width"),type:"number",max:design.sheet.width},model:{value:selection.width,callback:function(e){$set(selection,"width",_n(e))},expression:"selection.width"}}),_v(" "),_c("field",{attrs:{label:$t("panel.flap.height"),type:"number",max:design.sheet.height},model:{value:selection.height,callback:function(e){$set(selection,"height",_n(e))},expression:"selection.height"}}),_v(" "),_c("div",{staticClass:"mt-3"},[design.tree.node.size>3?_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.delete",expression:"'keyword.delete'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.deleteFlaps(selections)}}},[_v("Delete")]):_e()]),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.flap.goto",expression:"'panel.flap.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.flapToVertex(selections)}}})])],1)},mixins:[BaseComponent]}),Vue.component("flaps",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.flaps.type",expression:"'panel.flaps.type'"}]}),_v(" "),_c("div",{staticClass:"mt-3"},[design.tree.node.size>3?_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.delete",expression:"'keyword.delete'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.deleteFlaps(selections)}}}):_e()]),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.flaps.goto",expression:"'panel.flaps.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.flapToVertex(selections)}}})])])},mixins:[BaseComponent]}),Vue.component("panel",{render(){with(this)return _c("div",{ref:"panel",class:{show:show},attrs:{id:"divPanel"},on:{contextmenu:function(e){return e.stopPropagation(),onContextMenu(e)}}},[design?[0==selections.length?_c("design",{key:design.sheet.guid}):1==selections.length?_c("div",{key:selection.guid},[repository?_c("repository",{attrs:{repository:repository}}):_c(selection.type.toLowerCase(),{tag:"component"})],1):_c("div",["Flap"==selection.type?_c("flaps"):_e(),_v(" "),"Vertex"==selection.type?_c("vertices"):_e()],1)]:_e()],2)},mixins:[BaseComponent],props:{show:Boolean},watch:{"design.mode"(){let e=document.activeElement;e&&this.$refs.panel.contains(e)&&e.blur()}},computed:{repository(){let e=this.selection;return e?"Device"==e.type?e.pattern.configuration.repository:"Stretch"==e.type?e.repository:null:null}},methods:{onContextMenu(e){e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.preventDefault()}}}),Vue.component("repository",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.repo.type",expression:"'panel.repo.type'"}]}),_v(" "),repository.size>1?_c("store",{attrs:{data:repository,label:$t("panel.repo.config")}}):_e(),_v(" "),repository.entry.size>1?_c("store",{attrs:{data:repository.entry,label:$t("panel.repo.pattern")}}):1==repository.size?_c("div",{staticClass:"form-row"},[_c("label",{directives:[{name:"t",rawName:"v-t",value:"panel.repo.onlyOne",expression:"'panel.repo.onlyOne'"}],staticClass:"col-form-label col"})]):_e()],1)},props:{repository:Object}}),Vue.component("river",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.river.type",expression:"'panel.river.type'"}]}),_v(" "),_c("field",{attrs:{label:$t("panel.river.width"),type:"number"},model:{value:selection.length,callback:function(e){$set(selection,"length",_n(e))},expression:"selection.length"}}),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.delete",expression:"'keyword.delete'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.delete()}}})]),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.river.goto",expression:"'panel.river.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.riverToEdge(selection)}}})])],1)},mixins:[BaseComponent]}),Vue.component("vertex",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.vertex.type",expression:"'panel.vertex.type'"}]}),_v(" "),_c("field",{attrs:{label:$t("panel.vertex.name"),type:"text"},model:{value:selection.name,callback:function(e){$set(selection,"name",e)},expression:"selection.name"}}),_v(" "),_c("div",{staticClass:"mt-3 d-flex"},[_c("div",{staticClass:"flex-shrink-0 mr-2"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.vertex.addLeaf",expression:"'panel.vertex.addLeaf'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.addLeaf(newLength)}}}),_v("\n\t\t\t"+_s($t("panel.vertex.ofLength"))+"\n\t\t")]),_v(" "),_c("div",{staticClass:"flex-grow-1"},[_c("number",{attrs:{min:1},model:{value:newLength,callback:function(e){newLength=e},expression:"newLength"}})],1)]),_v(" "),design.tree.node.size>3?_c("div",{staticClass:"mt-3"},[1==selection.degree?_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.delete",expression:"'keyword.delete'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.node.dispose()}}}):_e(),_v(" "),2==selection.degree?_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.vertex.delJoin",expression:"'panel.vertex.delJoin'"}],staticClass:"btn btn-primary",on:{click:function(e){return selection.deleteAndJoin()}}}):_e()]):_e(),_v(" "),1==selection.degree?_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.vertex.goto",expression:"'panel.vertex.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.vertexToFlap(selections)}}})]):_e()],1)},mixins:[BaseComponent],data:()=>({newLength:1})}),Vue.component("vertices",{render(){with(this)return _c("div",[_c("h5",{directives:[{name:"t",rawName:"v-t",value:"panel.vertices.type",expression:"'panel.vertices.type'"}]}),_v(" "),selections.some(e=>1==e.degree)?_c("div",[design.vertices.size>3?_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.delete",expression:"'keyword.delete'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.deleteVertices(selections)}}}):_c("span",{directives:[{name:"t",rawName:"v-t",value:"message.min3vertex",expression:"'message.min3vertex'"}]})]):_e(),_v(" "),_c("div",{staticClass:"mt-3"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"panel.vertices.goto",expression:"'panel.vertices.goto'"}],staticClass:"btn btn-primary",on:{click:function(e){return design.vertexToFlap(selections)}}})])])},mixins:[BaseComponent]}),Vue.component("filemenu",{render(){with(this)return _c("dropdown",{attrs:{icon:"fas fa-file-alt",title:$t("toolbar.file.title")},on:{hide:reset}},[_c("div",{staticClass:"dropdown-item",on:{click:newProject}},[_c("i",{staticClass:"far fa-file"}),_v("\n\t\t"+_s($t("toolbar.file.new"))+"\n\t")]),_v(" "),_c("divider"),_v(" "),_c("uploader",{attrs:{accept:".bps, .bpz, .json, .zip",multiple:""},on:{upload:function(e){return upload(e)}}},[_c("i",{staticClass:"far fa-folder-open"}),_v("\n\t\t"+_s($t("toolbar.file.open"))+"\n\t")]),_v(" "),_c("download",{ref:"bps",attrs:{disabled:!design,file:jsonFile},on:{download:notify}},[_c("i",{staticClass:"fas fa-download"}),_v("\n\t\t"+_s($t("toolbar.file.saveBPS"))+"\n\t")]),_v(" "),_c("download",{ref:"bpz",attrs:{disabled:!design,file:workspaceFile},on:{download:notifyAll}},[_c("i",{staticClass:"fas fa-download"}),_v("\n\t\t"+_s($t("toolbar.file.saveBPZ"))+"\n\t")]),_v(" "),_c("divider"),_v(" "),_c("download",{ref:"svg",attrs:{disabled:!design,file:svgFile},on:{download:svgSaved}},[_c("i",{staticClass:"far fa-file-image"}),_v("\n\t\t"+_s($t("toolbar.file.saveSVG"))+"\n\t")]),_v(" "),_c("download",{ref:"png",attrs:{disabled:!design,file:pngFile},on:{download:pngSaved}},[_c("i",{staticClass:"far fa-file-image"}),_v("\n\t\t"+_s($t("toolbar.file.savePNG"))+"\n\t")]),_v(" "),copyEnabled?_c("dropdownitem",{attrs:{disabled:!design},on:{click:copyPNG}},[_c("i",{staticClass:"far fa-copy"}),_v("\n\t\t"+_s($t("toolbar.file.copyPNG"))+"\n\t")]):_e(),_v(" "),_c("divider"),_v(" "),_c("dropdownitem",{attrs:{disabled:!design},on:{click:print}},[_c("i",{staticClass:"fas fa-print"}),_v("\n\t\t"+_s($t("toolbar.file.print"))+"\n\t")]),_v(" "),_c("dropdownitem",{attrs:{disabled:!design},on:{click:function(e){return $emit("share")}}},[_c("i",{staticClass:"fas fa-share-alt"}),_v("\n\t\t"+_s($t("toolbar.file.share"))+"\n\t")])],1)},mixins:[BaseComponent],computed:{core:()=>core,jsonFile(){return this.design?{name:sanitize(this.design.title)+".bps",content:()=>bp.toBPS()}:{name:"",content:()=>""}},svgFile(){return this.design?{name:sanitize(this.design.title)+".svg",content:()=>bp.$display.toSVG()}:{name:"",content:()=>""}},pngFile(){return this.design?{name:sanitize(this.design.title)+".png",content:()=>bp.$display.toPNG()}:{name:"",content:()=>""}},workspaceFile(){return core.designs.length?{name:this.$t("keyword.workspace")+".bpz",content:()=>core.zip()}:{name:"",content:()=>""}},copyEnabled:()=>navigator.clipboard&&"write"in navigator.clipboard},methods:{newProject(){core.create(),gtag("event","project_create")},notify(){bp.design.history.notifySave(),gtag("event","project_bps")},notifyAll(){bp.designMap.forEach(e=>e.history.notifySave()),gtag("event","project_bpz")},svgSaved(){gtag("event","project_svg")},pngSaved(){gtag("event","project_png")},copyPNG(){bp.$display.copyPNG(),gtag("event","share",{method:"copy",content_type:"image"})},reset(){this.$refs.bps.reset(),this.$refs.bpz.reset(),this.$refs.svg.reset(),this.$refs.png.reset()},async upload(e){let t=e.target;await this.openFiles(t.files),t.value="",gtag("event","project_open")},async openFiles(e){if(e.length)for(let t=0;t<e.length;t++)await this.open(e[t])},async open(e){try{let t=await readFile(e),s=String.fromCharCode.apply(null,new Uint8Array(t.slice(0,1)));if("{"==s)core.addDesign(bp.load(bufferToText(t)));else{if("P"!=s)throw 1;await this.openWorkspace(t)}}catch(t){debugger;await core.alert(this.$t("message.invalidFormat",[e.name]))}},async openWorkspace(e){let t=await JSZip.loadAsync(e),s=[];t.forEach(e=>s.push(e));for(let e of s)try{let s=await t.file(e).async("text");core.addDesign(bp.load(s))}catch(t){debugger;await core.alert(this.$t("message.invalidFormat",[e]))}},print(){bp.$display.beforePrint(),setTimeout(window.print,500),gtag("event","print",{})}},mounted(){document.body.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),document.body.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&this.openFiles(e.dataTransfer.files)})}}),Vue.component("fullscreen",{render(){with(this)return _c("div",{directives:[{name:"show",rawName:"v-show",value:fullscreenEnabled,expression:"fullscreenEnabled"}],staticClass:"browser-only"},[_c("div",{staticClass:"dropdown-item",on:{click:toggleFullscreen}},[_c("i",{staticClass:"fas fa-expand"}),_v("\n\t\t"+_s($t("toolbar.setting.fullscreen"+(fullscreen?"Exit":"")))+"\n\t")]),_v(" "),_c("divider")],1)},data:()=>({fullscreen:!1,fullscreenEnabled:document.fullscreenEnabled||document.mozFullscreenEnabled||document.webkitFullscreenEnabled}),methods:{checkFullscreen(){this.fullscreen=window.matchMedia("(display-mode: fullscreen)").matches||!!document.fullscreenElement||!!document.mozFullScreenElement||!!document.webkitCurrentFullScreenElement},toggleFullscreen(){if(this.fullscreen){let e=document;(e.exitFullscreen||e.webkitExitFullscreen||e.mozCancelFullScreen).apply(e)}else{let e=document.documentElement;(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen).apply(e)}}},created(){document.addEventListener("fullscreenchange",()=>this.checkFullscreen()),document.addEventListener("mozfullscreenchange",()=>this.checkFullscreen()),document.addEventListener("webkitfullscreenchange",()=>this.checkFullscreen())}}),Vue.component("preference",{render(){with(this)return _c("div",{staticClass:"modal fade"},[_c("div",{staticClass:"modal-dialog modal-dialog-centered"},[_c("div",{staticClass:"modal-content mx-4"},[_c("div",{staticClass:"modal-header"},[_c("div",{directives:[{name:"t",rawName:"v-t",value:"toolbar.setting.preference",expression:"'toolbar.setting.preference'"}],staticClass:"h4 modal-title"})]),_v(" "),_c("div",{staticClass:"modal-body"},[_c("div",{staticClass:"form-group row"},[_c("label",{staticClass:"col-form-label col-4"},[_v("\n\t\t\t\t\t\t"+_s($t("preference.language"))+"\n\t\t\t\t\t")]),_v(" "),_c("div",{staticClass:"col-8"},[_c("select",{directives:[{name:"model",rawName:"v-model",value:i18n.locale,expression:"i18n.locale"}],staticClass:"form-control",on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));$set(i18n,"locale",e.target.multiple?t:t[0])}}},_l(i18n.availableLocales,(function(e){return _c("option",{directives:[{name:"t",rawName:"v-t",value:{path:"name",locale:e},expression:"{path:'name',locale:l}"}],key:e,domProps:{value:e}})})),0)])]),_v(" "),_c("field",{attrs:{label:$t("preference.autoSave"),type:"checkbox"},on:{input:function(e){return core.saveSettings()}},model:{value:core.autoSave,callback:function(e){$set(core,"autoSave",e)},expression:"core.autoSave"}}),_v(" "),_c("field",{attrs:{label:$t("preference.includeHidden"),type:"checkbox"},on:{input:function(e){return core.saveSettings()}},model:{value:display.includeHiddenElement,callback:function(e){$set(display,"includeHiddenElement",e)},expression:"display.includeHiddenElement"}})],1),_v(" "),_c("div",{staticClass:"modal-footer"},[_c("button",{directives:[{name:"t",rawName:"v-t",value:"keyword.ok",expression:"'keyword.ok'"}],staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"}})])])])])},computed:{i18n:()=>i18n,core:()=>core,display:()=>bp.$display.settings},methods:{show(){$(this.$el).modal(),gtag("event","screen_view",{screen_name:"Preference"})}}}),Vue.component("settingmenu",{render(){with(this)return _c("dropdown",{attrs:{icon:"fas fa-tasks",title:$t("toolbar.setting.title")}},[_c("fullscreen"),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showGrid")}}},[settings.showGrid?_c("i",{staticClass:"fas fa-grip-lines text-secondary"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.grid"))+"\n\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showHinge")}}},[settings.showHinge?_c("i",{staticClass:"fas fa-grip-lines text-primary"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.hinge"))+"\n\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showRidge")}}},[settings.showRidge?_c("i",{staticClass:"fas fa-grip-lines text-danger"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.ridge"))+"\n\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showAxialParallel")}}},[settings.showAxialParallel?_c("i",{staticClass:"fas fa-grip-lines text-success"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.axial"))+"\n\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showLabel")}}},[settings.showLabel?_c("i",{staticClass:"fas fa-font"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.label"))+"\n\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showDot")}}},[settings.showDot?_c("i",{staticClass:"fas fa-genderless"}):_c("i"),_v("\n\t\t"+_s($t("toolbar.setting.tip"))+"\n\t")]),_v(" "),core.isTouch?[_c("divider"),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return toggle("showDPad",core)}}},[core.showDPad?_c("i",{staticClass:"fas fa-arrows-alt"}):_c("i"),_v("\n\t\t\t"+_s($t("toolbar.setting.dPad"))+"\n\t\t")])]:_e(),_v(" "),_c("divider"),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return $emit("pref")}}},[_c("i",{staticClass:"fas fa-cog"}),_v("\n\t\t"+_s($t("toolbar.setting.preference"))+"\n\t")])],2)},mixins:[BaseComponent],computed:{core:()=>core,settings:()=>bp.$display.settings},methods:{toggle(e,t){t||(t=this.settings),t[e]=!t[e],core.saveSettings(),"showDPad"==e&&gtag("event","dpad_"+(t[e]?"on":"off"))}}}),Vue.component("toolbar",{render(){with(this)return _c("div",{staticClass:"btn-toolbar p-2",attrs:{id:"divToolbar"}},[_c("div",{staticClass:"btn-group mr-2"},[_c("filemenu",{on:{share:function(e){return $emit("share")}}}),_v(" "),_c("settingmenu",{on:{pref:function(e){return $emit("pref")}}}),_v(" "),_c("dropdown",{attrs:{icon:"fas fa-tools",title:$t("toolbar.tools.title")}},[_c("uploader",{attrs:{accept:".tmd5"},on:{upload:function(e){return TreeMaker(e)}}},[_c("i",{staticClass:"fas fa-file-import"}),_v("\n\t\t\t\t"+_s($t("toolbar.tools.TreeMaker"))+"\n\t\t\t")])],1),_v(" "),_c("dropdown",{attrs:{icon:"far fa-question-circle",title:$t("toolbar.help.title"),notify:notify||updated}},[_c("div",{staticClass:"dropdown-item",on:{click:function(e){return $emit("about")}}},[_c("i",{staticClass:"bp-info"}),_v("\n\t\t\t\t"+_s($t("toolbar.help.about"))+"\n\t\t\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:news}},[_c("i",{staticClass:"fas fa-newspaper"}),_v("\n\t\t\t\t"+_s($t("toolbar.help.news"))+"\n\t\t\t\t"),notify?_c("div",{staticClass:"notify"}):_e()]),_v(" "),updated?_c("div",{staticClass:"dropdown-item",on:{click:update}},[_c("i",{staticClass:"far fa-arrow-alt-circle-up"}),_v("\n\t\t\t\t"+_s($t("toolbar.help.update"))+"\n\t\t\t\t"),_c("div",{staticClass:"notify"})]):_e(),_v(" "),_c("divider"),_v(" "),_c("a",{staticClass:"dropdown-item",attrs:{href:"donate.htm",target:"_blank"}},[_c("i",{staticClass:"fas fa-hand-holding-usd"}),_v("\n\t\t\t\t"+_s($t("toolbar.help.donation"))+"\n\t\t\t")])],1)],1),_v(" "),_c("div",{staticClass:"btn-group mr-2"},[_c("button",{staticClass:"btn btn-primary",class:{active:design&&"tree"==design.mode},attrs:{type:"button",title:$t("toolbar.view.tree"),disabled:!design},on:{click:toTree}},[_c("i",{staticClass:"bp-tree"})]),_v(" "),_c("button",{staticClass:"btn btn-primary",class:{active:design&&"layout"==design.mode},attrs:{type:"button",title:$t("toolbar.view.layout"),disabled:!design},on:{click:toLayout}},[_c("i",{staticClass:"bp-layout"})])]),_v(" "),_c("div",{ref:"tab",staticClass:"flex-grow-1",attrs:{id:"divTab"},on:{wheel:function(e){return tabWheel(e)}}},[_c("draggable",_b({model:{value:core.designs,callback:function(e){$set(core,"designs",e)},expression:"core.designs"}},"draggable",dragOption,!1),_l(core.designs,(function(e){return _c("div",{key:e,staticClass:"tab",class:{active:design==getDesign(e)},attrs:{id:"tab"+e},on:{click:function(t){return core.select(e)}}},[_c("div",{staticClass:"d-none d-sm-flex",attrs:{title:getDesign(e).title},on:{contextmenu:function(t){return tabMenu(t,e)}}},[_c("div",[_v(_s(getTitle(e)))]),_v(" "),_c("div",{staticClass:"px-2",on:{click:function(t){return t.stopPropagation(),core.close(e)}}},[_c("i",{staticClass:"fas fa-times"})])]),_v(" "),_c("div",{staticClass:"d-flex d-sm-none",attrs:{title:getDesign(e).title}},[_c("div",[_v(_s(getTitle(e)))]),_v(" "),_c("div",{staticClass:"px-2",on:{click:function(t){return t.stopPropagation(),tabMenu(t,e)}}},[_c("i",{staticClass:"fas fa-caret-down"})])])])})),0)],1),_v(" "),_c("contextmenu",{ref:"tabMenu"},[_c("div",{staticClass:"dropdown-item",on:{click:function(e){return core.clone(menuId)}}},[_c("i",{staticClass:"far fa-clone"}),_v("\n\t\t\t"+_s($t("toolbar.tab.clone"))+"\n\t\t")]),_v(" "),_c("divider"),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return core.close(menuId)}}},[_c("i",{staticClass:"far fa-window-close"}),_v("\n\t\t\t"+_s($t("toolbar.tab.close"))+"\n\t\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return core.closeOther(menuId)}}},[_c("i",{staticClass:"far fa-window-close"}),_v("\n\t\t\t"+_s($t("toolbar.tab.closeOther"))+"\n\t\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return core.closeRight(menuId)}}},[_c("i",{staticClass:"far fa-window-close"}),_v("\n\t\t\t"+_s($t("toolbar.tab.closeRight"))+"\n\t\t")]),_v(" "),_c("div",{staticClass:"dropdown-item",on:{click:function(e){return core.closeAll()}}},[_c("i",{staticClass:"far fa-window-close"}),_v("\n\t\t\t"+_s($t("toolbar.tab.closeAll"))+"\n\t\t")])],1),_v(" "),_c("div",{staticClass:"btn-group",attrs:{id:"panelToggle"}},[_c("button",{staticClass:"btn btn-primary",attrs:{type:"button",title:$t("toolbar.panel"),disabled:!design},on:{click:function(e){return $emit("panel")}}},[_c("i",{staticClass:"fas fa-sliders-h"})])])],1)},mixins:[BaseComponent],data:()=>({notify:void 0,updated:!1,menuId:void 0}),computed:{dragOption:()=>({delay:500,delayOnTouchOnly:!0,touchStartThreshold:20,animation:200,forceFallback:!0,direction:"horizontal",scroll:!0}),core:()=>core},methods:{async update(){await core.confirm(this.$t("message.updateReady"))&&location.reload()},news(){this.notify&&(localStorage.setItem("last_log",logs[logs.length-1].toString()),this.notify=!1),this.$emit("news")},toLayout(){this.design.mode="layout"},toTree(){this.design.mode="tree"},tabWheel(e){0==e.deltaX&&(this.$refs.tab.scrollLeft-=e.deltaY/5)},async TreeMaker(e){let t=e.target;if(0==t.files.length)return;let s=bufferToText(await readFile(t.files[0])),i=t.files[0].name;try{core.open(bp.TreeMaker.parse(i.replace(/\.tmd5$/i,""),s))}catch(e){core.alert(this.$t(e.message,[i]))}t.value=""},tabMenu(e,t){this.menuId=t,this.$refs.tabMenu.show(e)},getDesign:e=>bp.designMap.get(e),getTitle(e){let t=this.getDesign(e).title;return t||this.$t("toolbar.project.noTitle")}},mounted(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",async e=>{"workbox-broadcast-update"===e.data.meta&&"/"==e.data.payload.path&&(this.updated=!0)});let e=parseInt(localStorage.getItem("last_log")||"0");this.notify=e<logs[logs.length-1]}});var i18n=new VueI18n({locale:"en",fallbackLocale:"en",silentFallbackWarn:!0,messages:locale}),core=new Vue.options.components.core({i18n:i18n});core.$mount("#core");var app=new Vue.options.components.app({i18n:i18n});app.$mount("#app");let url=new URL(location.href),lz=url.searchParams.get("project"),json;if(lz)try{json=JSON.parse(LZ.decompress(lz)),json.description&&(document.querySelector("meta[name=description]").content=json.description)}catch(e){}lz!=sessionStorage.getItem("project")&&json&&(sessionStorage.setItem("project",lz),core.addDesign(bp.load(json)),gtag("event","share_open")),document.addEventListener("wheel",(function(e){e.ctrlKey&&e.preventDefault()}),{passive:!1})}